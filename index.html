document.addEventListener('click', async e => {
  const socketBox = e.target.closest('.socket-box');
  if(socketBox && socketBox.classList.contains('available')) {
    const socket = socketBox.dataset.socket;
    const name = document.getElementById('name').value.trim();
    const purpose = document.getElementById('purpose').value.trim();
    const system = document.getElementById('system').value.trim();

    if(!name){
      alert('請先輸入姓名');
      return;
    }
    if(!purpose){
      alert('請先輸入用途');
      return;
    }
    if(!system){
      alert('請先輸入系統名稱');
      return;
    }

    if(currentUseDocs[socket]){
      alert('此插座已被使用');
      return;
    }

    try{
      await db.collection('sockets').add({
        socket,
        name,
        purpose,
        system,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });
      alert('登記成功！');
    }catch(err){
      alert('發生錯誤，請稍後再試');
      console.error(err);
    }
  }
});
